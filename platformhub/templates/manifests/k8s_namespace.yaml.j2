apiVersion: v1
kind: Namespace
metadata:
  name: {{ name }}-{{ environment }}
  labels:
    app.kubernetes.io/managed-by: platformhub
    environment: {{ environment }}
    {% if params.team %}
    team: {{ params.team }}
    {% endif %}
---
apiVersion: v1
kind: ResourceQuota
metadata:
  name: {{ name }}-quota
  namespace: {{ name }}-{{ environment }}
spec:
  hard:
    requests.cpu: {{ params.get('cpu_limit', '1') }}
    requests.memory: {{ params.get('memory_limit', '1Gi') }}
    limits.cpu: {{ params.get('cpu_limit', '1') }}
    limits.memory: {{ params.get('memory_limit', '1Gi') }}
    pods: "20"
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-ingress
  namespace: {{ name }}-{{ environment }}
spec:
  podSelector: {}
  policyTypes:
    - Ingress
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: {{ name }}-developers
  namespace: {{ name }}-{{ environment }}
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: edit
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: Group
    name: {{ params.get('team', name) }}-developers
